@using CUSrinagar.Extensions
@using CUSrinagar.Enums
@using CUSrinagar.Models
@using Nut
@model List<CUSrinagar.Models.ResultCompact>
@{
    Layout = null;
    string QRCodeData = string.Empty;
    string base64 = string.Empty;
    string QRImgSrc = string.Empty;
    string pmarksInWords = String.Empty;
}
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Marks Card</title>
    <link href="~/Content/ThemePublic/Libraries/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet" />
    <link href="/Content/ThemePublic/Libraries/css/Engstyle.css" rel="stylesheet" type="text/css" />
    <style>
        @@page {
            size: A4;
        }

        @@media print {
            #printPageButton {
                display: none;
            }
        }

        .background {
            position: absolute;
            top: 0%;
            left: 3%;
            z-index: 0;
            background: white;
            display: block;
            opacity: 0.35;
        }

        .bg-text {
            color: lightgray;
            font-size: 40px;
        }
    </style>
</head>
<body class="A4 middle portrait">

    @if (Model.IsNotNullOrEmpty())
    {
        var maxNumberOfSemesters = Model.SelectMany(x => x.SubjectResults).Max(x => x.Semester);
        foreach (ResultCompact STDINFO in Model)
        {
           if (STDINFO.SubjectResults.IsNotNullOrEmpty() && STDINFO.SubjectResults.Sum(x => x.TotalMaxMarks) == 7750)
            {
                <section class="sheet" style="height:2200px;font-size:9px !important;">
                    <br />
                    <div class="allmarkscard09" style="margin-top:0mm;margin-bottom:2mm;margin-right:5mm;margin-left:5mm;">

                        <div class="row">
                            <div class="col-sm-12">
                                @*<div class="row" style="margin-top: 1em;">*@
                                    <div class="center col-sm-12" >@*style="margin-top:20px"*@
                                        <table class="margin-top-0" >
                                            <tbody>
                                                <tr>
                                                    <td style="text-align:left;">
                                                        @*<img src="~/Content/ThemePublic/PrintImages/MarksSheetLogo.png" style="width:60px;margin-top:-25px;" />*@
                                                    </td>
                                                    <td>
                                                        <div style="margin-right:16px;">
                                                            @*<div class="wordart slate">
                                                                    <span class="text">
                                                                        Cluster University Srinagar
                                                                    </span>
                                                                </div>*@
                                                        </div>
                                                    </td>
                                                    <td>
                                                        <h3>
                                                            @*<i> @STDINFO.SerialNumber</i>*@
                                                        </h3>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                @*</div>*@

                                <p>

                                    @{QRCodeData = STDINFO.FullName;}
                                    @{QRCodeData += STDINFO.CUSRegistrationNo + Environment.NewLine;}

                                    @if (maxNumberOfSemesters == STDINFO.SubjectResults.Max(x => x.Semester) && STDINFO.SubjectResults.All(x => x.ShowPublic && x.OverallResultStatus == ResultStatus.P))
                                    {
                                        var AllSemesterMarksObtained = STDINFO.SubjectResults.Sum(x => x.TotalMarksObtained ?? 0).ToString("f0");
                                        var AllSemesterMaxMarks = STDINFO.SubjectResults.Sum(x => x.TotalMaxMarks).ToString("f0");
                                        QRCodeData += AllSemesterMarksObtained + "/" + AllSemesterMaxMarks + Environment.NewLine;
                                    }



                                    <table>
                                        <tr>
                                            <td></td>
                                            <td></td>
                                            <td style="text-align: right;"> <h4 class="text-success no-margin-bottom">Marks Sheet <small class="text-success no-margin-bottom"></small></h4></td>
                                            <td>

                                                @{
                                                    base64 = Convert.ToBase64String(QRCodeData.ToQRCode());
                                                    QRImgSrc = $"data:image/png;base64,{base64}";
                                                    QRCodeData = "";
                                                }
                                                <img src="@QRImgSrc" />
                                            </td>
                                        </tr>
                                    </table>





                                </p>

                                <hr class="margin-top-0 margin-bottom-1" style="margin-top: -1em;" />
                                <div class="row form-horizontal">
                                    <div class="col-sm-12">


                                        <!--Header General Info Section Begins-->
                                        <table border="0" style="line-height: 4mm;">
                                            <tbody style="text-align: left;">
                                                <tr>
                                                    <td style="width: 20mm;">&nbsp;Name:</td>
                                                    <td style="width: 100mm;font-weight: bold;">
                                                        @STDINFO.FullName.ToUpper()
                                                        @{QRCodeData = STDINFO.FullName;}
                                                    </td>
                                                    <td style="width: 50mm;">Registration No:</td>
                                                    <td style="width: 45mm;font-weight: bold;">
                                                        @STDINFO.CUSRegistrationNo.ToUpper().Trim()
                                                        @{QRCodeData += STDINFO.CUSRegistrationNo + Environment.NewLine;}
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td style="">&nbsp;Father:</td>
                                                    <td style="font-weight: bold;">@STDINFO.FathersName.ToUpper()</td>
                                                    <td style="">Exam Roll No:</td>
                                                    <td style="font-weight: bold;">@STDINFO.ExamRollNumber</td>
                                                </tr>
                                                <tr>
                                                    <td style="">&nbsp;Programme:</td>
                                                    <td style="font-weight: bold;">@STDINFO.DegreeCourseTitle.ToUpper()</td>
                                                    <td style="">Batch:</td>
                                                    <td style="font-weight: bold;">@STDINFO.Batch</td>
                                                </tr>
                                                <tr>
                                                    <td style="">&nbsp;College:<br />   &nbsp;</td>
                                                    <td style="font-weight: bold;">
                                                        @STDINFO.CollegeFullName.ToUpper()
                                                        <br />
                                                        @STDINFO.Address.ToUpper()
                                                        @*<small>@STDINFO.Address.ToUpper() </small>*@
                                                    </td>
                                                    <td style="">Medium Of Instruction:<br /></td>
                                                    <td style="font-weight: bold;">English<br /></td>
                                                </tr>
                                                <tr>
                                                    <td style="width: 20mm;">&nbsp;Mode:</td>
                                                    <td style="width: 100mm;font-weight: bold;">Regular</td>
                                                    <td style="width: 50mm;">Total Marks:</td>
                                                    <td style="width: 45mm;font-weight: bold;">
                                                        @if (maxNumberOfSemesters == STDINFO.SubjectResults.Max(x => x.Semester) && STDINFO.SubjectResults.All(x => x.ShowPublic && x.OverallResultStatus == ResultStatus.P))
                                                        {
                                                            var AllSemesterMarksObtained = STDINFO.SubjectResults.Sum(x => x.TotalMarksObtained ?? 0).ToString("f0");
                                                            var AllSemesterMaxMarks = STDINFO.SubjectResults.Sum(x => x.TotalMaxMarks).ToString("f0");
                                                            @(AllSemesterMarksObtained + "/" + AllSemesterMaxMarks)
                                                            QRCodeData += AllSemesterMarksObtained + "/" + AllSemesterMaxMarks + Environment.NewLine;
                                                        }
                                                    </td>
                                                </tr>




                                            </tbody>
                                        </table>
                                        <!---Header General Info Section Ends-->




                                    </div>
                                </div>

                                @if (STDINFO.TranscriptPrinted)
                                {
                                    <center>
                                        <h3 class="text-danger">Transcript has been already printed or handed over to the student.</h3>
                                    </center>
                                }
                                <div class="row center" style="opacity:1;">
                                    <div class="col-sm-12">
                                        <table border="1" class="center-text table table-bordered" style="margin-bottom:7px;font-size:10px;">
                                            <tbody>
                                                <tr>
                                                    <th></th>
                                                    <th title="Semester" style="padding-left:241px !important">@(CUSrinagar.Extensions.Helper.GetEnumDescription((Semester)1))</th>
                                                    <th title="Maximum internal marks">MM</th>
                                                    <th title="Internal marks obtained">MO</th>
                                                    <th title="Maximum external marks">MM</th>
                                                    <th title="External marks obtained">MO</th>
                                                    <th title="Total marks">MM</th>
                                                    <th title="Total marks obtained">MO</th>
                                                    <th></th>
                                                </tr>

                                                @{
                                                    var _Semesters = STDINFO.SubjectResults.Select(x => x.Semester).Distinct().OrderBy(x => x).ToList();
                                                    foreach (var _Semester in _Semesters)
                                                    {
                                                        List<SubjectResult> _SemesterSubjects = STDINFO.SubjectResults.Where(x => x.Semester == _Semester && x.HasResult).OrderBy(x => x.SubjectType).ToList();

                                                        var SNO = 1;
                                                        if (_SemesterSubjects.IsNotNullOrEmpty() && _SemesterSubjects.Any(x => x.ShowPublic))
                                                        {
                                                            foreach (SubjectResult item in _SemesterSubjects)
                                                            {
                                                                string code = CUSrinagar.DataManagers.GeneralFunctions.GetSubjectTypeCode(item.SubjectType);
                                                                <tr>
                                                                    <td>@(SNO++)</td>
                                                                    <td class="text-align-left" style="text-align:left;">
                                                                        <span class="">@item.SubjectFullName.ToUpper()</span>
                                                                        @*@(string.IsNullOrEmpty(code) ? "" : "(" + code + ")")*@
                                                                    </td>
                                                                    @*<th>
                                                                            @item.TotalCredit
                                                                        </th>*@
                                                                    <td title="Internal max marks">
                                                                        @if (item.HasInternalComponent)
                                                                        {
                                                                            <span>@(item.TotalInternalMaxMarks?.ToString("f0"))</span>
                                                                        }
                                                                        else
                                                                        {
                                                                            <span>-</span>
                                                                        }
                                                                    </td>
                                                                    <td title="Internal marks obtained">
                                                                        @if (item.HasInternalComponent && item.ShowPublic)
                                                                        {
                                                                            if (item.TotalInternalMarksObtained.HasValue && (item.InternalStatus == ResultStatus.P || item.InternalStatus == ResultStatus.F))
                                                                            {
                                                                                <span>@item.TotalInternalMarksObtained.Value.ToString("f0")</span>
                                                                            }
                                                                            else
                                                                            {
                                                                                <span>NA</span>
                                                                            }
                                                                        }
                                                                        else
                                                                        {
                                                                            <span>-</span>
                                                                        }
                                                                    </td>
                                                                    <td title="External max marks">
                                                                        @if (item.HasExternalComponent)
                                                                        {
                                                                            <span>@(item.TotalExternalMaxMarks?.ToString("f0"))</span>
                                                                        }
                                                                        else
                                                                        {
                                                                            <span>-</span>
                                                                        }
                                                                    </td>
                                                                    <td title="External marks obtained">
                                                                        @if (item.HasExternalComponent && item.ShowPublic)
                                                                        {
                                                                            if (item.HasInternalComponent)
                                                                            {
                                                                                if (item.InternalStatus == ResultStatus.P)
                                                                                {
                                                                                    if (item.TotalExternalMarksObtained.HasValue && (item.ExternalStatus == ResultStatus.P || item.ExternalStatus == ResultStatus.F))
                                                                                    {
                                                                                        <span>@item.TotalExternalMarksObtained.Value.ToString("f0")</span>
                                                                                    }
                                                                                    else
                                                                                    {
                                                                                        <span>@item.ExternalStatus.ToString()</span>
                                                                                    }
                                                                                }
                                                                                else
                                                                                {
                                                                                    <span>F</span>
                                                                                }
                                                                            }
                                                                            else
                                                                            {
                                                                                if (item.TotalExternalMarksObtained.HasValue && (item.ExternalStatus == ResultStatus.P || item.ExternalStatus == ResultStatus.F))
                                                                                {
                                                                                    <span>@item.TotalExternalMarksObtained.Value.ToString("f0")</span>
                                                                                }
                                                                                else
                                                                                {
                                                                                    <span>@item.ExternalStatus.ToString()</span>
                                                                                }
                                                                            }
                                                                        }
                                                                        else
                                                                        {
                                                                            <span>-</span>
                                                                        }
                                                                    </td>
                                                                    <td title="total max marks">@item.TotalMaxMarks.ToString("f0") </td>
                                                                    <td title="total marks obtained">
                                                                        @if (item.TotalMarksObtained.HasValue && item.OverallResultStatus == ResultStatus.P && item.ShowPublic)
                                                                        {
                                                                            <span>@item.TotalMarksObtained.Value.ToString("f0")</span>
                                                                        }
                                                                        else
                                                                        {
                                                                            <span>-</span>
                                                                        }
                                                                    </td>
                                                                    <td title="result status">
                                                                        @if (item.OverallResultStatus == ResultStatus.P && item.ShowPublic)
                                                                        {
                                                                            <span>P</span>
                                                                        }
                                                                        else
                                                                        {
                                                                            <span title="@(Helper.GetEnumDescription<ResultStatus>(item.OverallResultStatus))">F</span>
                                                                        }
                                                                    </td>
                                                                </tr>
                                                            }
                                                        }
                                                        <tr>
                                                            <th colspan="6"></th>
                                                            <th>
                                                                @_SemesterSubjects.Sum(x => x.TotalMaxMarks).ToString("f0")
                                                            </th>
                                                            <th>
                                                                @if (_SemesterSubjects.Where(x => x.HasResult).All(x => x.OverallResultStatus == ResultStatus.P && x.ShowPublic))
                                                                {
                                                                    <b>@_SemesterSubjects.Where(x => x.HasResult).Sum(x => x.TotalMarksObtained).Value.ToString("f0")</b>
                                                                }
                                                                else
                                                                {
                                                                    <span>-</span>
                                                                }
                                                            </th>
                                                            <th>
                                                                @if (_SemesterSubjects.All(x => x.OverallResultStatus == ResultStatus.P && x.ShowPublic))
                                                                {
                                                                    <span>P</span>
                                                                }
                                                                else
                                                                {< span > F </ span >}
                                                            </th>

                                                            @if (_Semester + 1 == 5)
                                                            {
                                                            <tr style="border:none;">
                                                                <th colspan="9" style="text-align:center;border:none;"> <small>Page 1/2</small></th>
                                                            </tr>
                                                        }
                                                            </tr>



                                                            <tr>
                                                                <th colspan="9">

                                                                    @if (_Semester + 1 == 5)
                                                                    {

                                                                        <h3 style="visibility: hidden;">This is a computer Generated This is  This is a computer Generated This is This is a computer Generated This is This is This is a computer Generated This is</h3>
                                                                        @*<div class="footer">page 1/2</div>*@
                                                                    }
                                                                    @if (_Semesters.Any(x => x == (_Semester + 1)))
                                                                    {
                                                                        @(CUSrinagar.Extensions.Helper.GetEnumDescription((Semester)((short)(_Semester + 1))))
                                                                    }
                                                                </th>
                                                            </tr>
                                                        }
                                                }
                                            </tbody>
                                        </table>

                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-sm-12">
                                        <table>
                                            <tbody>
                                                <tr>
                                                    <td widt="30%" ;>
                                                        Date of passing: <b><span>@STDINFO.SubjectResults.Max(x => x.NotificationDate).Value.ToString("dd-MMM-yyyy")</span></b>
                                                    </td>
                                                    <td width="10%">
                                                        Notification No.: <b><span>@STDINFO.NotificationNo</span></b>
                                                    </td>
                                                    <td colspan="2" width="40%" style="text-align:right;">
                                                        @if (maxNumberOfSemesters == STDINFO.SubjectResults.Max(x => x.Semester) && STDINFO.SubjectResults.All(x => x.ShowPublic && x.OverallResultStatus == ResultStatus.P))
                                                        {
                                                            var AllSemesterMarksObtained = STDINFO.SubjectResults.Sum(x => x.TotalMarksObtained ?? 0).ToString("f0");
                                                            var AllSemesterMaxMarks = STDINFO.SubjectResults.Sum(x => x.TotalMaxMarks).ToString("f0");
                                                            <b><span>Total Marks:</span> <span style="font-size: 16px;">@(AllSemesterMarksObtained + "/" + AllSemesterMaxMarks)</span></b>
                                                            <b><span>Result: P</span></b>
                                                            int pmarks = Convert.ToInt32(AllSemesterMarksObtained);
                                                            @Html.Hidden("MksObt",(Object)ViewBag.MksObt)
                                                            pmarksInWords = (pmarks < 0) ? ((CUSrinagar.Enums.ResultStatus)pmarks).ToString() : pmarks.ToText(Language.English).ToUpper();
                                                        }
                                                        else
                                                        {
                                                            <span>&emsp;&emsp;Total Marks:</span> <b>(<span>@("00" + "/" + STDINFO.SubjectResults.Sum(x => x.TotalMaxMarks).ToString("f0"))</span>)</b>
                                                            <span>Result:F</span>
                                                        }
                                                    </td>

                                                </tr>
                                                <tr>
                                                    <td colspan="3">
                                                        Marks Secured:                                                   
                                                        <b><span>@pmarksInWords</span></b>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td style="width:30%;text-align:center;">
                                                        <img style="height:15mm;width:30mm;" src="~/FolderManager/Transcript/Prog.png" /><br />
                                                        Dealing Assistant
                                                    </td>
                                                    <td style="width:45%;">
                                                        <img style="height:15mm;width:30mm;" src="~/FolderManager/Transcript/gulzar_ar.png" /><br />
                                                        Assistant Controller
                                                    </td>
                                                    <td style="width:30%;">
                                                        <img style="height:15mm;width:30mm;" src="~/FolderManager/Transcript/Controller.png" /><br />
                                                        Controller Of Examination
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td colspan="4">
                                                        <br />
                                                        <div class="well no-padding no-margin-bottom" style="width:110px;display:inline-block;"><span>MM – Max Marks</span></div>
                                                        <div class="well no-padding no-margin-bottom" style="width:133px;display:inline-block;"><span>MO – Marks Obtained</span></div>
                                                        <div class="well no-padding no-margin-bottom" style="width:55px;display:inline-block;"><span>P – Pass</span></div>
                                                        <div class="well no-padding no-margin-bottom" style="width:55px;display:inline-block;"><span>F - Fail</span></div>
                                                        <div class="well no-padding no-margin-bottom" style="width:87px;display:inline-block;"><span>LO - Later On</span></div>
                                                        <div class="well no-padding no-margin-bottom" style="width:118px;display:inline-block;"><span>NA – Not Available</span></div>
                                                        <div class="well no-padding no-margin-bottom" style="width:60px;display:inline-block;"><span>E. & O.E</span></div>
                                                    </td>
                                                </tr>




                                                <tr style="border:none;">
                                                    <th colspan="9" style="text-align:center;border:none;"> <small>Page 2/2</small></th>
                                                </tr>
                                            </tbody>
                                        </table>

                                        @*<table>
                                                <tbody>
                                                    <tr>

                                                        <td>
                                                            Marks Secured: <b><span>@pmarksInWords</span></b>
                                                        </td>

                                                    </tr>
                                                </tbody>
                                            </table>*@


                                        <!---Footer Sign Section Begins-->
                                        <!---Footer Sign Section Ends-->


                                    </div>
                                </div>


                            </div>
                        </div>
                    </div>
                </section>

            }
        }
    }
    else
    {
        <section class="sheet padding-5mm">
            <p>Result Not Found .... </p>
        </section>
    }

    <br /><br />
    <div class="noneOnPrint" style="height:40px;background-color:lightslategrey;width:42% !important;position:fixed;bottom:0;z-index:100;text-align:center;padding-top:10px">
        <button style="height: 32px;margin-left:2em;" href="#" class="btn btn-theme" onclick="window.print();"><b>Download or Print</b></button>
    </div>
    <script src="~/Content/ThemeAdmin/Content/Scripts/Libraries/jquery-3.2.1.min.js"></script>
    <script src="~/Scripts/General/general.js"></script>
    <script src="~/Scripts/Pages/admin-transcript.js"></script>
</body>
</html>