
@using CUSrinagar.Extensions;
@using GeneralModels;

@model  List<CUSrinagar.Models.ReEvaluationStatistics>

@{
    ViewBag.Title = "ReEvaluation Statistics";
}

@section CUSSitemap
{

    <div class="col-md-5">
        <ul class="breadcrumb">
            <li>
                <i class="ace-icon fa fa-home home-icon"></i>
                <a href="@Url.Action("Index", "Dashboard", new { area = "CUCollegeAdminPanel" })">Home</a>
            </li>
            <li class="active">ReEvaluation Statistics</li>
        </ul><!-- /.breadcrumb -->
    </div>
}

<div class="row">
    <div class="col-md-12 jsTableContent">
        <div class="row container-fluid">
            <div class="panel-body">
                <div class="search-box">
                    <form action="@Url.Action("ReEvaluationStatistics","Statistics")" method="post" class="form-inline">

                        <div class="form-group">
                            <label>Year</label><br />
                            <div class="jsDDLContainer">
                                @Html.DropDownList("SubmittedYear", new SelectList(ViewBag.SubmittedYear, "Value", "Text", ViewBag.Year),
                               null, new
                               {
                                   @class = "form-control jsfilterelement",
                                   @data_column = "Semester",
                                   @data_tablealias = "ReEvaluation",
                                   @data_operator = "EqualTo"
                               })
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Program</label><br />
                            <div class="jsDDLContainer">
                                @Html.DropDownList("PrintProgramme", new SelectList(ViewBag.PrintProgrammeList, "Value", "Text", ViewBag.PrintProgramme),
                               null, new
                               {
                                   @class = "form-control",
                                   @data_column = "PrintProgramme",
                                   @data_operator = "EqualTo"
                               })
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Semester</label><br />
                            <div class="jsDDLContainer">
                                @Html.DropDownList("Semester", new SelectList(ViewBag.Semesters, "Value", "Text", ViewBag.Semester),
                               null, new
                               {
                                   @class = "form-control jsfilterelement",
                                   @data_column = "Semester",
                                   @data_tablealias = "ReEvaluation",
                                   @data_operator = "EqualTo"
                               })
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Type</label><br />
                            <div class="jsDDLContainer">
                                @Html.DropDownList("Type", new SelectList(ViewBag.FormTypeList, "Value", "Text", ViewBag.Type),
                             "Select Form Type", new
                             {
                                 @class = "form-control jsfilterelement",
                                 @data_column = "Semester",
                                 @data_tablealias = "ReEvaluation",
                                 @data_operator = "EqualTo"
                             })

                            </div>
                        </div>
                        <div class="form-group">
                            <label class="invisible">for styling purpose</label><br />
                            <button type="submit" class="btn btn-sm btn-primary fa-search-btn js-search"><i class="fa fa-search"></i>&nbsp;Search</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <hr />
        <div class="row container-fluid">
            @{
                if (Model.IsNullOrEmpty())
                {
                    <hr />
                    <hr />
                    <h1 class="center"><i>No Data Found for the specified filters. Please try again with different filters.</i></h1>
                    <hr />
                    <hr />

                }
                else
                {
                    <h2 class="center">Total Number of Forms = @Model.Sum(i => i.NoOfStudents)</h2>

                    Parameters paramters = new Parameters()
                    {
                        Filters = new List<SearchFilter>(){new SearchFilter()
                                                {
                                                    Column = nameof(CUSrinagar.Models.ReEvaluation.SubmittedYear),
                                                    Operator = CUSrinagar.Enums.SQLOperator.EqualTo,
                                                    Value = ViewBag.Year == null ? "" : ViewBag.Year.ToString(),
                                                    TableAlias = nameof(CUSrinagar.Models.ReEvaluation)
                                                 },
                                                 new SearchFilter()
                                                {
                                                    Column = nameof(CUSrinagar.Models.ReEvaluation.Semester),
                                                    Operator = CUSrinagar.Enums.SQLOperator.EqualTo,
                                                    Value = ViewBag.Semester == null ? "" : ViewBag.Semester.ToString(),
                                                    TableAlias = nameof(CUSrinagar.Models.ReEvaluation)
                                                }
                                            }
                    };
                    if (ViewBag.Type == null)
                    {

                    }
                    else
                    {
                        paramters.Filters.Add(new SearchFilter()
                        {
                            Column = nameof(CUSrinagar.Models.ReEvaluation.FormType),
                            Operator = CUSrinagar.Enums.SQLOperator.EqualTo,
                            Value = ViewBag.Type == null ? "" : ((short)ViewBag.Type).ToString(),
                            TableAlias = nameof(CUSrinagar.Models.ReEvaluation)
                        });
                    }

                    foreach (var item in Model)
                    {
                        <div class="col-xs-12 col-sm-6 widget-container-col ui-sortable" id="widget-container-col-6">
                            <div class="widget-box widget-color-dark light-border ui-sortable-handle" id="widget-box-6">
                                <h3 style="background-color:lightblue;padding:15px" class="center">@item.FormType.ToString()</h3>
                                <div class="widget-body">
                                    <div class="widget-main padding-6">
                                        <table class="table table-striped table-dark">
                                            <tbody>

                                                <tr style="border-bottom:solid 1px black">
                                                    <td colspan="2">
                                                        <a href="@item.Link" target="_blank">
                                                            @{
                                                                item.NotificationID = item.NotificationID;
                                                            }
                                                            @item.NotificationID
                                                        </a>

                                                    </td>
                                                </tr>
                                                <tr style="border-bottom:solid 1px black">

                                                    <td>
                                                        Examination Year
                                                    </td>

                                                    <td>

                                                        <strong>@item.SubmittedYear</strong>

                                                    </td>
                                                </tr>
                                                <tr style="border-bottom:solid 1px black">
                                                    <td>
                                                        Semester
                                                    </td>
                                                    <td>
                                                        <strong>@item.Semester</strong>
                                                    </td>
                                                </tr>

                                                <tr style="border-bottom:solid 1px black">

                                                    <td>
                                                        Start Date
                                                    </td>
                                                    <td>
                                                        <strong>@item.StartDate.ToShortDateString()</strong>
                                                    </td>
                                                </tr>
                                                <tr style="border-bottom:solid 1px black">

                                                    <td>
                                                        End Date
                                                    </td>
                                                    <td>
                                                        <strong>@item.EndDate.ToShortDateString()</strong>
                                                    </td>
                                                </tr>

                                                @{

                                                    if (item.FormType == CUSrinagar.Enums.FormType.ReEvaluation)
                                                    {
                                                        paramters.Filters.Add(new SearchFilter() { Column = nameof(CUSrinagar.Models.ReEvaluation.FormType), Operator = CUSrinagar.Enums.SQLOperator.EqualTo, Value = ((short)CUSrinagar.Enums.FormType.ReEvaluation).ToString() });
                                                        <tr style="border-bottom:solid 1px black">
                                                            <td>
                                                                Re Evaluation Forms
                                                            </td>
                                                            <td>
                                                                <form action="" id="GetReEvaluations" method="post">
                                                                    <a href="#" class="btn btn-inverse">Number of Forms = <strong>@item.NoOfStudents</strong></a>

                                                                </form>
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <td colspan="2">
                                                                <a href="javascript:void(0);" class="ReEvaluationAnchor btn btn-success"
                                                                   data-value="@Url.Action("ReEvaluationXerox", "DeanResult", new { @Parameters = Json.Encode(paramters), @otherParam1 = ViewBag.PrintProgramme })"
                                                                   target="_blank">
                                                                    @{
                                                                        item.NotificationID = item.NotificationID;
                                                                        GeneralModels.SearchFilter filter = paramters.Filters.First(i => i.Column == nameof(CUSrinagar.Models.ReEvaluation.FormType));
                                                                        paramters.Filters.Remove(filter);
                                                                    }
                                                                    View List
                                                                </a>
                                                            </td>
                                                        </tr>
                                                        <tr style="border-top:inset 2px black;border-bottom:ridge 2px black">
                                                            <td style="width:70%">
                                                                Total Amount Received
                                                            </td>
                                                            <td>
                                                                <strong>
                                                                    @item.AmountReceived
                                                                </strong>
                                                            </td>
                                                        </tr>
                                                    }
                                                    else
                                                    {
                                                        paramters.Filters.Add(new SearchFilter() { Column = nameof(CUSrinagar.Models.ReEvaluation.FormType), Operator = CUSrinagar.Enums.SQLOperator.EqualTo, Value = ((short)CUSrinagar.Enums.FormType.Xerox).ToString() });
                                                        <tr style="border-bottom:solid 1px black">
                                                            <td>
                                                                Xerox Forms
                                                            </td>
                                                            <td>
                                                                <form action="" id="GetReEvaluations" method="post">
                                                                    <a href="#" class="btn btn-inverse">Total Number of Forms = <strong>@item.NoOfStudents</strong></a>
                                                                </form>
                                                            </td>
                                                        </tr>

                                                        <tr>
                                                            <td colspan="2">
                                                                <a href="javascript:void(0);" class="ReEvaluationAnchor btn btn-success"
                                                                   data-value="@Url.Action("ReEvaluationXerox", "DeanResult", new { @Parameters = Json.Encode(paramters), @otherParam1 = ViewBag.PrintProgramme })"
                                                                   target="_blank">
                                                                    @{
                                                                        if (item.NotificationID.Length > 100)
                                                                        {
                                                                            item.NotificationID = item.NotificationID.Substring(0, 80) + "...";
                                                                        }

                                                                        GeneralModels.SearchFilter filter = paramters.Filters.First(i => i.Column == nameof(CUSrinagar.Models.ReEvaluation.FormType));
                                                                        paramters.Filters.Remove(filter);
                                                                    }
                                                                    View List
                                                                </a>
                                                            </td>
                                                        </tr>
                                                        <tr style="border-top:inset 2px black;border-bottom:ridge 2px black">
                                                            <td style="width:70%">
                                                                Total Amount Received
                                                            </td>
                                                            <td>
                                                                <strong>
                                                                    @item.AmountReceived
                                                                </strong>
                                                            </td>
                                                        </tr>
                                                    }
                                                }

                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    }

                }
            }
        </div>
    </div>
</div>


@section PageSpecificJS
{
    <script type="text/javascript">
        $(document).ready(function () {

            $('.ReEvaluationAnchor').click(function () {
                var paramters = $(this).attr('data-value');
                $('#GetReEvaluations').attr('action', paramters);
                $('#GetReEvaluations').submit();
            });

            $("#ReEvaluationXeroxListItem").addClass("active open");
            $("#ReEvaluationXeroxListListItem").addClass("active");
            $('.date-picker').datepicker({
                autoclose: true,
                todayHighlight: true,
                dateFormat: 'mm/dd/yyyy',
                format: 'mm/dd/yyyy'
            })


        });

    </script>
}
